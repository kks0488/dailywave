# DailyWave Status — 2026-01-30

## 목표

- iPad / iPhone / Web 어디서든 **같은 계정으로 로그인**하면 동일한 데이터(워크플로우/루틴)가 보이도록 **Supabase Cloud 동기화**를 붙인다.
- AI/패턴 기능(죽어있는 기능)을 실제 UX로 연결하면서, 옵션/폴백(로컬) 기반으로 안정성을 유지한다.

---

## 현재 상황 요약

- GitHub `main`에 로그인/동기화 기반 작업이 반영되어 있음.
- Vercel 배포에서 `supabaseUrl is required` 에러가 발생했었고, **Supabase env가 없을 때도 앱이 크래시하지 않도록** 프론트를 수정함.
- 다크모드/스크롤/루틴추가 UX 등의 자잘한 UX 이슈도 같이 정리/개선됨.

---

## 반영된 핵심 기능 (요약)

### 1) Supabase Cloud 로그인 + 크로스디바이스 동기화

- OAuth 콜백 처리: `/auth/callback`
  - `frontend/src/components/AuthCallback.jsx`
  - `frontend/src/App.jsx`
- Settings 내 Account 섹션: 로그인/로그아웃 + “Sync now”
  - `frontend/src/components/AppleCommandCenter.jsx`
- Supabase env 미설정 시 graceful fallback
  - `frontend/src/lib/supabase.js` (env 없으면 `supabase=null`)
  - `frontend/src/lib/__tests__/supabase.test.js`
- 저장 시 workspace가 없으면 자동 생성(레이스 대비)
  - `frontend/src/lib/supabaseSync.js`
- Supabase Cloud 설정 문서 업데이트
  - `docs/SUPABASE_SETUP.md`

### 2) Victory Wall — 루틴 패턴 코치(옵션/폴백)

- Victory Wall에 “AI 인사이트 추가” 버튼으로 `analyzeRoutinePatterns` 연결
  - AI 키 없으면 로컬 인사이트만 유지 (graceful)

### 3) UX 품질 개선

- 메인 패널 내부 스크롤바 숨김(스크롤은 유지)
- 루틴 추가 인라인 폼: 바깥 클릭/ESC로 닫힘(취소 UX)
- Chaos Dump “AI 연결하면 자동 정리” 힌트: 다크모드 대비 개선

---

## Supabase Cloud 세팅 체크리스트 (너가 해야 할 것)

### A. Supabase 프로젝트 생성

1. Supabase Cloud에서 `dailywave` 프로젝트 생성
2. Region 선택, DB password 보관

### B. DB 스키마 + RLS 적용

1. Supabase → SQL Editor
2. `supabase/migrations/001_initial_schema.sql` 전체 실행

### C. Auth 설정

1. Supabase → Authentication → Providers
2. 최소 Google enable (원하면 Apple/GitHub도)
3. Authentication → URL Configuration
   - Site URL: `https://dailywave.vercel.app`
   - Redirect URLs:
     - `https://dailywave.vercel.app/auth/callback`
     - `http://localhost:3005/auth/callback`

### D. Vercel 환경변수 추가 + 재배포

1. Vercel 프로젝트 → Settings → Environment Variables
2. 아래 2개 추가:
   - `VITE_SUPABASE_URL`
   - `VITE_SUPABASE_ANON_KEY`
3. Deployments에서 **Redeploy** (env 반영을 위해 필수)

---

## 알려진 이슈 / 주의사항

- Vercel이 GitHub `main`의 새 커밋으로 자동 배포가 안 되는 경우가 있었음 → Deployments에서 수동 Redeploy로 확인 필요.
- Supabase Auth Redirect URL이 하나라도 빠지면 로그인 후 콜백이 실패하거나 무한 루프/에러가 날 수 있음.

---

## 다음 단계 (추천)

1. Supabase Cloud 세팅 완료 후 Vercel env + Redeploy
2. 웹에서 로그인 → 데이터 생성 → iPad/iPhone에서 동일 계정 로그인하여 동기화 확인
3. 충돌/머지 정책(로컬 vs 클라우드) UX를 더 안전하게 다듬기
   - 예: “이 기기 로컬 데이터를 클라우드로 올릴까요?” / “클라우드로 덮어쓸까요?” 선택 UI

